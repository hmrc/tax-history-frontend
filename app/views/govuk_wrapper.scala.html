@*
 * Copyright 2025 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import config.AppConfig
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import views.models.PageTitle

@this(
    appConfig: AppConfig,
    govukTemplate: GovukTemplate,
    govukBackLink: GovukBackLink,
    govukPhaseBanner: GovukPhaseBanner,
    hmrcHead: HmrcHead,
    hmrcStandardHeader: HmrcStandardHeader,
    hmrcStandardFooter: HmrcStandardFooter,
    hmrcReportTechnicalIssueHelper: HmrcReportTechnicalIssueHelper,
    hmrcScripts: HmrcScripts,
    hmrcTimeoutDialogHelper: HmrcTimeoutDialogHelper,
    hmrcLanguageSelectHelper: HmrcLanguageSelectHelper,
)

@(
    title: PageTitle,
    beforeContentHtml: Option[Html] = None,
    researchBannerUrl: Option[String] = None,
    signOut: Boolean = true,
    timeoutActive: Boolean = true,
    backLink: Option[String]= None,
)(mainContent: Html)(implicit request: RequestHeader, messages: Messages, appConfig: config.AppConfig)

@head ={
    <meta name="format-detection" content="telephone=no" />
    <link rel="stylesheet" media="all" href='@routes.Assets.versioned("stylesheets/taxhistory.css")' type="text/css"/>

    @if(timeoutActive) {
        @hmrcTimeoutDialogHelper(
            signOutUrl = routes.SignedOutController.logout().url,
            keepAliveUrl = Some(controllers.routes.SignedOutController.keepAlive().url),
            timeoutUrl =  Some(controllers.routes.SignedOutController.signedOut().url),
            timeout = Some(appConfig.timeout),
            countdown = Some(appConfig.timeoutCountdown),
            None,
            message = Some(messages("timeout.message")),
            keepAliveButtonText = Some(messages("timeout.keepAlive")),
            signOutButtonText = Some(messages("timeout.signOut"))
        )
    }
}

@feedbackBanner = {
    @messages("feedback.before")
    <a class='govuk-link' href='@{appConfig.betaFeedbackUrl}'>@messages("feedback.link")</a>
    @messages("feedback.after")
}

@beforeContentBlock = {
    @if(appConfig.welshEnabled){
        @hmrcLanguageSelectHelper()
    }
    @if(signOut){
        @govukBackLink(BackLink(href = backLink.fold("#")(customUrl => customUrl), content = Text(messages("lbl.back")), attributes = Map("id" -> "back-link")))
    }
}

@content = {

    @mainContent

    <div class="govuk-!-font-size-19">
        @hmrcReportTechnicalIssueHelper()
    </div>
}

    @header = {
        @hmrcStandardHeader(
            serviceName = Some(messages("service.name")),
            serviceUrl = Some(appConfig.agentAccountHomePage),
            signOutUrl = if(signOut) Some(routes.SignedOutController.logout().url) else None,
            phaseBanner = Some(
                PhaseBanner(
                    tag = Some(Tag(content = Text("beta"))),
                    content = HtmlContent(feedbackBanner)
                )
            )
        )

        <div class="govuk-width-container">

                <!-- ACCOUNT MENU -->
            <nav id="secondary-nav" class="hmrc-account-menu" aria-label="Account" data-module="hmrc-account-menu">
                @if(signOut){
                    <a id="nav-home" href="@appConfig.agentAccountHomePage" class="hmrc-account-menu__link hmrc-account-menu__link--home hmrc-account-menu__link--active">
                        <span class="hmrc-account-icon hmrc-account-icon--home">@messages("nav.home")</span>
                    </a>
                }

                @if(request.path.contains("record") || request.path.contains("/no-data/") || request.path.contains("tax-year") ) {
                    <a href="#" class="hmrc-account-menu__link hmrc-account-menu__link--menu js-hidden js-visible" tabindex="-1" aria-hidden="true" aria-expanded="false">@messages("nav.menu")</a>
                }

                <ul class="hmrc-account-menu__main js-hidden">
                    @defining(request.path.contains("record") || request.path.contains("/no-data/")) { navigationCheck =>
                        @if(request.path == "/tax-history/select-tax-year" || navigationCheck) {
                            <li>
                                <a id="nav-client" href="@routes.SelectClientController.getSelectClientPage()" class="hmrc-account-menu__link">@messages("nav.client")</a>
                            </li>
                        }

                        @if(navigationCheck) {
                            <li>
                                <a id="nav-year" href="@routes.SelectTaxYearController.getSelectTaxYearPage()" class="hmrc-account-menu__link">@messages("nav.year")</a>
                            </li>
                        }
                    }
                </ul>
            </nav>
                <!-- END ACCOUNT MENU -->
        </div>
    }


@govukTemplate(
    htmlLang = Some(messages.lang.code),
    pageTitle = Some(title.fullTitle()),
    headBlock = Some(hmrcHead(headBlock = Some(head))),
    headerBlock = header,
    beforeContentBlock = Some(beforeContentBlock),
    footerBlock = hmrcStandardFooter(),
    mainClasses = None,
    bodyEndBlock = Some(hmrcScripts() )
)(content)
